{"version":"1","records":[{"hierarchy":{"lvl1":"手で解く量子化学 手で解く課題"},"type":"lvl1","url":"/","position":0},{"hierarchy":{"lvl1":"手で解く量子化学 手で解く課題"},"content":"手で解く量子化学の課題をPythonで解いてみた。","type":"content","url":"/","position":1},{"hierarchy":{"lvl1":"対象分子の設定"},"type":"lvl1","url":"/tedetoku-kadai-1-4-1","position":0},{"hierarchy":{"lvl1":"対象分子の設定"},"content":"He およびＨの核座標がそれぞれ (0, 0, 0)， (0, 0, 1.4) （bohr単位） のとき， HeH＋  の基底状態 （1σ2） に対する RHF波動関数とRHF エネルギーを求めよ． 基底関数は  STO-NG (N＝1, 2, 3, 4, 5, 6) のいずれかとして， 付録の HeH系の分子積分の値を用  いよ． SCF の収束判定は， エネルギーについてのみ行い， 閾値は 0.0001 hartree とせ  よ． また， 得られた RHF波動関数を用いて Mulliken の電子密度解析を行い， He お  よびＨ原子の電荷を求めよ．\n\n中井浩巳. 手で解く量子化学 I (p. 86). (Function). Kindle Edition.\n\n基底関数は、STO-6Gとする。\n\nfrom types import MappingProxyType\nfrom itertools import product\n\nimport numpy as np\nfrom scipy.linalg import ishermitian\n\n","type":"content","url":"/tedetoku-kadai-1-4-1","position":1},{"hierarchy":{"lvl1":"対象分子の設定"},"type":"lvl1","url":"/tedetoku-kadai-1-4-1#id","position":2},{"hierarchy":{"lvl1":"対象分子の設定"},"content":"\n\n核電荷Z_\\mathrm{He}=2.0, Z_\\mathrm{H}=1.0, 核座標\\boldsymbol{R}_\\mathrm{He}=(0.0, 0.0, 0.0), \\boldsymbol{R}_\\mathrm{H}=(0.0, 0.0, 1.4)より、核反発エネルギー\n\nV_\\mathrm{nuc} = \\sum_{A=1}^M \\sum_{B>A}^M \\frac{Z_A Z_B}{R_{AB}}   \\tag{3.2}\n\nZ_He = 2.0\n\"\"\"Heの核電荷\"\"\"\nZ_H = 1.0\n\"\"\"Hの核電荷\"\"\"\n\nV_nuc = (Z_He * Z_H) / 1.4\n\"\"\"核間のポテンシャルエネルギー\"\"\"\nV_nuc\n\n","type":"content","url":"/tedetoku-kadai-1-4-1#id","position":3},{"hierarchy":{"lvl1":"正準直行化の実行"},"type":"lvl1","url":"/tedetoku-kadai-1-4-1#id-1","position":4},{"hierarchy":{"lvl1":"正準直行化の実行"},"content":"\n\nS = np.array([[1.0, 0.56059], [0.56059, 1.0]])\n\"\"\"重なり行列 (付録より)\"\"\"\nS\n\ndef unitary_diagonalization(arr: np.ndarray) -> tuple[np.ndarray, np.ndarray]:\n    \"\"\"ユニタリ対角化関数\n\n    Parameters\n    ----------\n    arr : np.ndarray\n        対角化する行列\n\n    Returns\n    -------\n    tuple[np.ndarray, np.ndarray]\n        対角化された行列とユニタリ行列\n\n    Raises\n    ------\n    ValueError\n        エルミート行列でない場合\n    \"\"\"\n    if ishermitian(arr, rtol=1e-05, atol=1e-08):\n        # エルミート行列の固有ベクトル\n        _, u = np.linalg.eigh(arr)\n\n        # Uの随伴行列(共役転置)\n        u_dagger = np.conjugate(u.T)\n\n        # エルミート行列をユニタリ行列で対角化\n        diag_matrix = u_dagger @ arr @ u\n\n        # データ型を整数に変更して小さな誤差が入っている虚部を取り除く\n        # 単位行列をかけて対角成分以外の要素の誤差を小さくする\n        diag_matrix = diag_matrix.astype(np.float64) * np.identity(\n            arr.shape[0], dtype=np.float64\n        )\n\n        return diag_matrix, u\n    else:\n        raise ValueError(\"The matrix is not Hermitian.\")\n\n\ns, U = unitary_diagonalization(S)\n\"\"\"s: 固有値\nU: 固有ベクトル\"\"\"\nprint(f\"{s=}\")\nprint(f\"{U=}\")\n\n正準直交化の変換行列 X は、X_\\mathrm{can} = U s^{-\\frac{1}{2}} \\tag{4.36}\n\n# 行列を^(-1/2)する。'-' は逆行列の意味\ndef inverse_sqrt_matrix(arr: np.ndarray) -> np.ndarray:\n    \"\"\"行列の^(-1/2)を計算する関数\n\n    Parameters\n    ----------\n    arr : np.ndarray\n        ^(-1/2)を計算する行列\n\n    Returns\n    -------\n    np.ndarray\n        ^(-1/2)された行列\n    \"\"\"\n    return np.linalg.inv(np.sqrt(arr))\n\n\ninverse_sqrt_matrix(s)\n\nX = U @ inverse_sqrt_matrix(s)\n\"\"\"正準直行化の変換行列\"\"\"\nX\n\n","type":"content","url":"/tedetoku-kadai-1-4-1#id-1","position":5},{"hierarchy":{"lvl1":"コアハミルトニアン行列の計算"},"type":"lvl1","url":"/tedetoku-kadai-1-4-1#id-2","position":6},{"hierarchy":{"lvl1":"コアハミルトニアン行列の計算"},"content":"\n\nH = np.array([[-2.6444, -1.5118], [-1.5118, -1.7782]])\n\"\"\"コアハミルトニアン行列 (付録より)\"\"\"\nH\n\n","type":"content","url":"/tedetoku-kadai-1-4-1#id-2","position":7},{"hierarchy":{"lvl1":"密度行列の初期値"},"type":"lvl1","url":"/tedetoku-kadai-1-4-1#id-3","position":8},{"hierarchy":{"lvl1":"密度行列の初期値"},"content":"\n\n直行化基底に対するコアハミルトン行列 H' は、H'=X^T HX   \\tag{4.2}\n\nH_prime = X.T @ H @ X\n\"\"\"正準直交化基底に対するコアハミルトニアン行列\"\"\"\nH_prime\n\n_, C_prime = unitary_diagonalization(H_prime)\n\"\"\"正準直交化基底に対する分子軌道係数行列\"\"\"\nC_prime\n\nC = X @ C_prime\n\"\"\"分子軌道係数行列\"\"\"\nC\n\n密度行列 \\boldsymbol{P} は、P_{\\mu\\nu} = 2 \\sum_{i} c_{\\mu i}^* c_{\\nu i} \\tag{4.19}\n\niは、分子軌道の足、\\mu, \\nuは原子軌道の足\n\nHeH+ では、占有軌道 \\varphi_1 だけなので、 (1\\sigma 軌道だけという意味と解釈)\n\ndef calculate_density_matrix(C: np.ndarray) -> np.ndarray:\n    \"\"\"密度行列を計算する関数\n\n    Parameters\n    ----------\n    C : np.ndarray\n        分子軌道係数行列\n\n    Returns\n    -------\n    np.ndarray\n        密度行列\n    \"\"\"\n    return 2 * (C[:, [0]] @ C[:, [0]].T)\n\n\nP = calculate_density_matrix(C)\n\"\"\"密度行列\"\"\"\nP\n\n","type":"content","url":"/tedetoku-kadai-1-4-1#id-3","position":9},{"hierarchy":{"lvl1":"電子反発積分の計算"},"type":"lvl1","url":"/tedetoku-kadai-1-4-1#id-4","position":10},{"hierarchy":{"lvl1":"電子反発積分の計算"},"content":"\n\nMAP_ELECTRON_REPULSION_INTEGRAL = MappingProxyType(\n    {\n        ((1, 1), (1, 1)): 1.05625,\n        ((1, 1), (1, 2)): 0.46768,\n        ((1, 1), (2, 1)): 0.46768,\n        ((1, 1), (2, 2)): 0.60640,\n        ((1, 2), (1, 1)): 0.46768,\n        ((1, 2), (1, 2)): 0.24649,\n        ((1, 2), (2, 1)): 0.24649,\n        ((1, 2), (2, 2)): 0.38871,\n        ((2, 1), (1, 1)): 0.46768,\n        ((2, 1), (1, 2)): 0.24649,\n        ((2, 1), (2, 1)): 0.24649,\n        ((2, 1), (2, 2)): 0.38871,\n        ((2, 2), (1, 1)): 0.60640,\n        ((2, 2), (1, 2)): 0.38871,\n        ((2, 2), (2, 1)): 0.38871,\n        ((2, 2), (2, 2)): 0.77500,\n    }\n)\n\"\"\"電子反発積分 (付録より)\"\"\"\nNone\n\n","type":"content","url":"/tedetoku-kadai-1-4-1#id-4","position":11},{"hierarchy":{"lvl1":"Fock行列の計算"},"type":"lvl1","url":"/tedetoku-kadai-1-4-1#fock","position":12},{"hierarchy":{"lvl1":"Fock行列の計算"},"content":"\n\nF_{\\mu \\nu} = H_{\\mu \\nu} + G_{\\mu \\nu} \\tag{4.3} \\\\\n\nH_{\\mu \\nu} は、\n\n先ほど求めているので、G_{\\mu \\nu} を求めたい。\\begin{align*}\n    J_{\\mu \\nu} &= \\sum_{\\lambda, \\sigma} (\\mu \\nu | \\lambda \\sigma) P_{\\lambda \\sigma} \\tag{4.25} \\\\\n    K_{\\mu \\nu} &= \\sum_{\\lambda, \\sigma} (\\mu \\sigma | \\lambda \\nu) P_{\\lambda \\sigma} \\tag{4.26} \\\\\n    G_{\\mu \\nu} &= J_{\\mu \\nu} - \\frac{1}{2} K_{\\mu \\nu} \\tag{4.27} \\\\\n\\end{align*}\n\ndef calculate_coulomb_energy_matrix(P: np.ndarray) -> np.ndarray:\n    \"\"\"クーロンエネルギー行列を計算する関数\n\n    Parameters\n    ----------\n    P : np.ndarray\n        密度行列\n\n    Returns\n    -------\n    np.ndarray\n        クーロンエネルギー行列\n    \"\"\"\n    return np.array(\n        [\n            [\n                sum(\n                    MAP_ELECTRON_REPULSION_INTEGRAL[\n                        (_mu, _nu), (_lambda, _sigma)\n                    ]\n                    * P[_lambda - 1, _sigma - 1]  # Pは0-indexedなので-1する\n                    for _lambda, _sigma in product((1, 2), repeat=2)\n                )\n                for _nu in (1, 2)\n            ]\n            for _mu in (1, 2)\n        ]\n    )\n\n\nJ = calculate_coulomb_energy_matrix(P)\n\"\"\"クーロンエネルギー行列\"\"\"\nJ\n\ndef calculate_exchange_energy_matrix(P: np.ndarray) -> np.ndarray:\n    \"\"\"交換エネルギー行列を計算する関数\n\n    Parameters\n    ----------\n    P : np.ndarray\n        密度行列\n\n    Returns\n    -------\n    np.ndarray\n        交換エネルギー行列\n    \"\"\"\n    return np.array(\n        [\n            [\n                sum(\n                    MAP_ELECTRON_REPULSION_INTEGRAL[\n                        (_mu, _sigma), (_lambda, _nu)\n                    ]\n                    * P[_lambda - 1, _sigma - 1]  # Pは0-indexedなので-1する\n                    for _lambda, _sigma in product((1, 2), repeat=2)\n                )\n                for _nu in (1, 2)\n            ]\n            for _mu in (1, 2)\n        ]\n    )\n\n\nK = calculate_exchange_energy_matrix(P)\n\"\"\"交換エネルギー行列\"\"\"\nK\n\nG = J - 0.5 * K\n\"\"\"2電子積分行列\"\"\"\nG\n\nF = H + G\n\"\"\"Fock行列\"\"\"\nF\n\ndef density2fock(P: np.ndarray) -> np.ndarray:\n    \"\"\"密度行列からFock行列を計算する関数\n\n    Parameters\n    ----------\n    P : np.ndarray\n        密度行列\n\n    Returns\n    -------\n    np.ndarray\n        Fock行列\n    \"\"\"\n    G = calculate_coulomb_energy_matrix(\n        P\n    ) - 0.5 * calculate_exchange_energy_matrix(P)\n    return H + G\n\n\ndensity2fock(P)\n\n","type":"content","url":"/tedetoku-kadai-1-4-1#fock","position":13},{"hierarchy":{"lvl1":"RHFエネルギーの計算"},"type":"lvl1","url":"/tedetoku-kadai-1-4-1#rhf","position":14},{"hierarchy":{"lvl1":"RHFエネルギーの計算"},"content":"\n\nE_0 = 0.5 * np.sum(P * (H + F))\n\"\"\"ハミルトニアンに対するRHFエネルギー\"\"\"\nE_0\n\nE_tot = E_0 + V_nuc\n\"\"\"RHF全エネルギー\"\"\"\nE_tot\n\ndef calculate_total_energy(P: np.ndarray) -> float:\n    \"\"\"全エネルギーを計算する関数\n\n    Parameters\n    ----------\n    P : np.ndarray\n        密度行列\n\n    Returns\n    -------\n    float\n        全エネルギー\n    \"\"\"\n    F = density2fock(P)\n    return 0.5 * np.sum(P * (H + F)) + V_nuc\n\n\ncalculate_total_energy(P)\n\n","type":"content","url":"/tedetoku-kadai-1-4-1#rhf","position":15},{"hierarchy":{"lvl1":"Roothan-hall方程式の解法"},"type":"lvl1","url":"/tedetoku-kadai-1-4-1#roothan-hall","position":16},{"hierarchy":{"lvl1":"Roothan-hall方程式の解法"},"content":"基本的には\n\nFock行列を求めるから\n\nRHFエネルギーの計算までを繰り返して、収束要件を満たしたら終わり。\n\ndef scf_cycle(\n    P: np.ndarray, threshold: float = 1e-4\n) -> tuple[float, np.ndarray]:\n    \"\"\"SCFサイクルを行う関数\n\n    Parameters\n    ----------\n    P : np.ndarray\n        密度行列\n\n    Returns\n    -------\n    tuple[float, np.ndarray]\n        全エネルギーと密度行列\n    \"\"\"\n    # 初期化\n    E_tot_prev = np.inf\n    # 全エネルギー\n    E_tot = calculate_total_energy(P)\n    # 収束判定 (全エネルギーの変化量が閾値以下になるまで繰り返す)\n    while (E_tot_prev - E_tot) > threshold:\n        print(f\"{E_tot=}\")\n        # 全エネルギーを保存\n        E_tot_prev = E_tot\n        # 密度行列からFock行列を計算\n        F = density2fock(P)\n        # 直交化基底に対するFock行列\n        F_prime = X.T @ F @ X\n        # Fock行列をユニタリ対角化して、(軌道エネルギーと) 分子軌道係数行列を求める\n        _, C_prime = unitary_diagonalization(F_prime)\n        # 分子軌道係数行列を元の基底に戻す\n        C = X @ C_prime\n        # 密度行列を計算\n        P = calculate_density_matrix(C)\n        # 全エネルギーを計算\n        E_tot = calculate_total_energy(P)\n    return E_tot, P\n\nenergy_total_opt, P_opt = scf_cycle(P)\nprint(f\"{energy_total_opt=}\")\nprint(f\"{P_opt=}\")\n\n","type":"content","url":"/tedetoku-kadai-1-4-1#roothan-hall","position":17},{"hierarchy":{"lvl1":"分子物性の計算"},"type":"lvl1","url":"/tedetoku-kadai-1-4-1#id-5","position":18},{"hierarchy":{"lvl1":"分子物性の計算"},"content":"\n\nMullikenの電荷解析N_A^\\mathrm{Mul} = \\sum_{\\mu \\in A} \\sum_{\\nu} P_{\\mu \\nu} S_{\\nu \\mu} = \\sum_{\\mu \\in A} (\\rm{PS})_{\\mu \\mu} \\tag{4.53}\n\nN_He = (P_opt @ S)[0, 0]\n\"\"\"Heの電子数\"\"\"\nN_H = (P_opt @ S)[1, 1]\n\"\"\"Hの電子数\"\"\"\nprint(f\"{N_He=}\")\nprint(f\"{N_H=}\")\n\nよって、Mulliken電荷は、Q_A = Z_A - N_A^\\mathrm{mul} \\tag{4.54}\n\nより、\n\nQ_He = Z_He - N_He\n\"\"\"Heの電荷\"\"\"\nQ_H = Z_H - N_H\n\"\"\"Hの電荷\"\"\"\nprint(f\"{Q_He=}\")\nprint(f\"{Q_H=}\")\n\nepsilon_opt, C_prime_opt = unitary_diagonalization(\n    X.T @ density2fock(P_opt) @ X\n)\nC_opt = X @ C_prime_opt\nprint(f\"{epsilon_opt=}\")\nprint(f\"{C_opt=}\")","type":"content","url":"/tedetoku-kadai-1-4-1#id-5","position":19},{"hierarchy":{"lvl1":"対象分子の設定"},"type":"lvl1","url":"/tedetoku-kadai-1-5-1","position":0},{"hierarchy":{"lvl1":"対象分子の設定"},"content":"He およびＨの核座標が， それぞれ (0, 0,0)， (0, 0, 1.4) （bohr単位） のとき，  HeH の基底状態 （1σ2 2σ1） に対する UHF波動関数とUHF エネルギーを求めよ． 基底  関数は STO-NG (N＝1, 2, 3, 4, 5, 6) のいずれかとして， 付録の HeH 系の分子積分  の値を用 い よ． SCF の収束判定は， エ ネ ル ギ ー に つ い て の み行い， 閾値は  0.0001 hartree とせよ． また， 得られた UHF波動関数を用いて Mulliken の電子密度  解析を行い， He およびＨ原子の電荷およびスピン密度を求めよ．\n\n中井浩巳. 手で解く量子化学 I (p. 99). (Function). Kindle Edition.\n\n基底関数は、STO-6Gとする。\n\nfrom types import MappingProxyType\nfrom itertools import product\n\nimport numpy as np\nfrom scipy.linalg import ishermitian\n\n","type":"content","url":"/tedetoku-kadai-1-5-1","position":1},{"hierarchy":{"lvl1":"対象分子の設定"},"type":"lvl1","url":"/tedetoku-kadai-1-5-1#id","position":2},{"hierarchy":{"lvl1":"対象分子の設定"},"content":"\n\n核電荷Z_\\mathrm{He}=2.0, Z_\\mathrm{H}=1.0, 核座標\\boldsymbol{R}_\\mathrm{He}=(0.0, 0.0, 0.0), \\boldsymbol{R}_\\mathrm{H}=(0.0, 0.0, 1.4)より、核反発エネルギー\n\nV_\\mathrm{nuc} = \\sum_{A=1}^M \\sum_{B>A}^M \\frac{Z_A Z_B}{R_{AB}}   \\tag{3.2}\n\nZ_He = 2.0\n\"\"\"Heの核電荷\"\"\"\nZ_H = 1.0\n\"\"\"Hの核電荷\"\"\"\n\nV_nuc = (Z_He * Z_H) / 1.4\n\"\"\"核間のポテンシャルエネルギー\"\"\"\nV_nuc\n\nN_alpha = 2\n\"\"\"upスピンの電子数\"\"\"\nN_beta = 1\n\"\"\"downスピンの電子数\"\"\"\n\n","type":"content","url":"/tedetoku-kadai-1-5-1#id","position":3},{"hierarchy":{"lvl1":"正準直行化の実行"},"type":"lvl1","url":"/tedetoku-kadai-1-5-1#id-1","position":4},{"hierarchy":{"lvl1":"正準直行化の実行"},"content":"重なり積分 \\boldsymbol{S} は、核座標と基底関数にのみ依存し、電子数には依存しない。\n\nS = np.array([[1.0, 0.56059], [0.56059, 1.0]])\n\"\"\"重なり行列 (付録より)\"\"\"\nS\n\ndef unitary_diagonalization(arr: np.ndarray) -> tuple[np.ndarray, np.ndarray]:\n    \"\"\"ユニタリ対角化関数\n\n    Parameters\n    ----------\n    arr : np.ndarray\n        対角化する行列\n\n    Returns\n    -------\n    tuple[np.ndarray, np.ndarray]\n        対角化された行列とユニタリ行列\n\n    Raises\n    ------\n    ValueError\n        エルミート行列でない場合\n    \"\"\"\n    if ishermitian(arr, rtol=1e-05, atol=1e-08):\n        # エルミート行列の固有ベクトル\n        _, u = np.linalg.eigh(arr)\n\n        # Uの随伴行列(共役転置)\n        u_dagger = np.conjugate(u.T)\n\n        # エルミート行列をユニタリ行列で対角化\n        diag_matrix = u_dagger @ arr @ u\n\n        # データ型を整数に変更して小さな誤差が入っている虚部を取り除く\n        # 単位行列をかけて対角成分以外の要素の誤差を小さくする\n        diag_matrix = diag_matrix.astype(np.float64) * np.identity(\n            arr.shape[0], dtype=np.float64\n        )\n\n        return diag_matrix, u\n    else:\n        raise ValueError(\"The matrix is not Hermitian.\")\n\n\ns, U = unitary_diagonalization(S)\n\"\"\"s: 固有値\nU: 固有ベクトル\"\"\"\nprint(f\"{s=}\")\nprint(f\"{U=}\")\n\n正準直交化の変換行列 X は、X_\\mathrm{can} = U s^{-\\frac{1}{2}} \\tag{4.36}\n\n# 行列を^(-1/2)する。'-' は逆行列の意味\ndef inverse_sqrt_matrix(arr: np.ndarray) -> np.ndarray:\n    \"\"\"行列の^(-1/2)を計算する関数\n\n    Parameters\n    ----------\n    arr : np.ndarray\n        ^(-1/2)を計算する行列\n\n    Returns\n    -------\n    np.ndarray\n        ^(-1/2)された行列\n    \"\"\"\n    return np.linalg.inv(np.sqrt(arr))\n\n\ninverse_sqrt_matrix(s)\n\nX = U @ inverse_sqrt_matrix(s)\n\"\"\"正準直行化の変換行列\"\"\"\nX\n\n","type":"content","url":"/tedetoku-kadai-1-5-1#id-1","position":5},{"hierarchy":{"lvl1":"コアハミルトニアン行列の計算"},"type":"lvl1","url":"/tedetoku-kadai-1-5-1#id-2","position":6},{"hierarchy":{"lvl1":"コアハミルトニアン行列の計算"},"content":"核座標と基底関数のみに依存し、電子数には依存しない。\n\nH = np.array([[-2.6444, -1.5118], [-1.5118, -1.7782]])\n\"\"\"コアハミルトニアン行列 (付録より)\"\"\"\nH\n\n","type":"content","url":"/tedetoku-kadai-1-5-1#id-2","position":7},{"hierarchy":{"lvl1":"密度行列の初期値"},"type":"lvl1","url":"/tedetoku-kadai-1-5-1#id-3","position":8},{"hierarchy":{"lvl1":"密度行列の初期値"},"content":"\n\n","type":"content","url":"/tedetoku-kadai-1-5-1#id-3","position":9},{"hierarchy":{"lvl1":"密度行列の初期値","lvl2":"係数行列を求める方法"},"type":"lvl2","url":"/tedetoku-kadai-1-5-1#id-4","position":10},{"hierarchy":{"lvl1":"密度行列の初期値","lvl2":"係数行列を求める方法"},"content":"\n\n","type":"content","url":"/tedetoku-kadai-1-5-1#id-4","position":11},{"hierarchy":{"lvl1":"密度行列の初期値","lvl3":"1-4-1と同じ方法","lvl2":"係数行列を求める方法"},"type":"lvl3","url":"/tedetoku-kadai-1-5-1#id-1-4-1","position":12},{"hierarchy":{"lvl1":"密度行列の初期値","lvl3":"1-4-1と同じ方法","lvl2":"係数行列を求める方法"},"content":"コアハミルトニアン行列を使うパターン\n\n直行化基底に対するコアハミルトン行列 H' は、H'=X^T HX   \\tag{4.2}\n\nH_prime = X.T @ H @ X\n\"\"\"正準直交化基底に対するコアハミルトニアン行列\"\"\"\nH_prime\n\n_, C_prime = unitary_diagonalization(H_prime)\n\"\"\"正準直交化基底に対する分子軌道係数行列\"\"\"\nC_prime\n\nC = X @ C_prime\n\"\"\"分子軌道係数行列\"\"\"\nC\n\n","type":"content","url":"/tedetoku-kadai-1-5-1#id-1-4-1","position":13},{"hierarchy":{"lvl1":"密度行列の初期値","lvl3":"MO軌道をAOと仮定する方法","lvl2":"係数行列を求める方法"},"type":"lvl3","url":"/tedetoku-kadai-1-5-1#mo-ao","position":14},{"hierarchy":{"lvl1":"密度行列の初期値","lvl3":"MO軌道をAOと仮定する方法","lvl2":"係数行列を求める方法"},"content":"\n\n\\varphi_1^\\alpha = \\varphi_1^\\beta = \\chi_1 \\\\\n\\varphi_2^\\alpha = \\varphi_2^\\beta = \\chi_2\n\nとする。\n\nつまり、1番目のMOはHeの1s軌道、2番目のMOはHの1s軌道と仮定している。\n\nこれらは直交ではないので直交化してあげる必要がある。\n\n正準直交化: せっかく意味のあるMO軌道を仮定しているのに全く意味がなくなるので不適\n\n対称直交化: HF法では、占有軌道のみ直交化されれば良いのだが、すべての分子軌道に対して直交化が行われるので不適\n\n-> Gram-Schmidtの直交化 (今回のケースでは、\\alpha電子のすべてのMOが\\alpha電子の占有軌道となり、メリットはないが。)\n\n1番目の分子軌道について、|\\varphi'_1 \\rangle = \\frac{|\\varphi_1 \\rangle}{\\sqrt{\\langle \\varphi_1 |  \\varphi_1 \\rangle}} \\tag{4.44}\n\nより、|\\varphi'_1 \\rangle = \\frac{|\\chi_1 \\rangle}{\\sqrt{\\langle \\chi_1 |  \\chi_1 \\rangle}} = \\frac{|\\chi_1 \\rangle}{\\sqrt{1.0}} = |\\chi_1 \\rangle\n\n2番目の分子軌道について、|\\varphi''_2 \\rangle = |\\varphi_2 \\rangle - |\\varphi'_1 \\rangle  \\langle \\varphi'_1 | \\varphi_2 \\rangle = \\left( 1-|\\varphi'_1 \\rangle \\langle \\varphi'_1 | \\right) | \\varphi_2 \\rangle \\tag{4.45}\n\nより、\\begin{align*}\n    \\varphi''_2 &= |\\varphi_2 \\rangle - |\\varphi'_1 \\rangle  \\langle \\varphi'_1 | \\varphi_2 \\rangle \\\\\n    &= |\\chi_2 \\rangle - |\\chi_1 \\rangle \\langle \\chi_1 | \\chi_2 \\rangle \\\\\n    &= - 0.56059 \\times |\\chi_1 \\rangle + |\\chi_2 \\rangle\\ \\ \\ \\because 付録より \\langle \\chi_1 | \\chi_2 \\rangle = 0.56059\n\\end{align*}\n\nさらに、規格化する。|\\varphi'_2 \\rangle = \\frac{|\\varphi''_2 \\rangle}{\\sqrt{\\langle \\varphi''_2 | \\varphi''_2 \\rangle}} \\tag{4.46}\n\nより、\n\n$$\\begin{align*}\n    |\\varphi'_2 \\rangle &= \\frac{|\\varphi''_2 \\rangle}{\\sqrt{\\langle \\varphi''_2 | \\varphi''_2 \\rangle}} \\\\\n    &= \\frac{- 0.56059 \\times |\\chi_1 \\rangle + |\\chi_2 \\rangle}{\\sqrt{(- 0.56059)^2 \\langle \\chi_1 | \\chi_1 \\rangle + 2 \\cdot (- 0.56059) \\langle \\chi_1 | \\chi_2 \\rangle + \\langle \\chi_2 | \\chi_2 \\rangle }} \\\\\n    &= \\frac{- 0.56059 \\times |\\chi_1 \\rangle + |\\chi_2 \\rangle}{\\sqrt{(- 0.56059)^2 \\cdot 1.0 + 2 \\cdot (- 0.56059) \\cdot (-0.56059) + 1.0 }} \\\\\n    &= \\frac{- 0.56059 \\times |\\chi_1 \\rangle + |\\chi_2 \\rangle}{1.39384} \\\\\n    &= -0.40220 \\times |\\chi_1 \\rangle + 0.71744 \\times |\\chi_2 \\rangle\n\\end{align*}\n\n$$\n\nつまり、\n\nC = np.array([[1.0, -0.40220], [0.0, 0.71744]])\n\"\"\"分子軌道係数行列\"\"\"\nC\n\n","type":"content","url":"/tedetoku-kadai-1-5-1#mo-ao","position":15},{"hierarchy":{"lvl1":"密度行列の初期値","lvl2":"係数行列から密度行列を求める"},"type":"lvl2","url":"/tedetoku-kadai-1-5-1#id-5","position":16},{"hierarchy":{"lvl1":"密度行列の初期値","lvl2":"係数行列から密度行列を求める"},"content":"\n\n密度行列 \\boldsymbol{P} は、\\alphaスピン、\\betaスピンそれぞれに対して、P_{\\mu\\nu}^\\alpha = 2 \\sum_{i} {c_{\\mu i}^\\alpha}^* c_{\\nu i}^\\alpha \\ ,\\  P_{\\mu\\nu}^\\beta = 2 \\sum_{i} {c_{\\mu i}^\\beta}^* c_{\\nu i}^\\beta \\tag{5.19}\n\niは、分子軌道の足、\\mu, \\nuは原子軌道の足\n\nHeH では、N_\\alpha=2, N_\\beta=1より、\\begin{align*}\n    P_{\\mu \\nu}^\\alpha &= 2 \\left(c_{\\mu 1}^\\alpha c_{\\nu 1}^\\alpha + c_{\\mu 2}^\\alpha c_{\\nu 2}^\\alpha \\right) \\\\\n    P_{\\mu \\nu}^\\beta &= 2 c_{\\mu 1}^\\beta c_{\\nu 1}^\\beta\n\\end{align*}\n\ndef calculate_density_matrix_alpha(C: np.ndarray) -> np.ndarray:\n    \"\"\"密度行列を計算する関数\n\n    Parameters\n    ----------\n    C : np.ndarray\n        分子軌道係数行列\n\n    Returns\n    -------\n    np.ndarray\n        密度行列\n    \"\"\"\n    return C @ C.T  # 1-4-1と違って2を掛けないのは閉殻でないから。\n\n\nP_alpha = calculate_density_matrix_alpha(C)\n\"\"\"密度行列\"\"\"\nP_alpha\n\ndef calculate_density_matrix_beta(C: np.ndarray) -> np.ndarray:\n    \"\"\"密度行列を計算する関数\n\n    Parameters\n    ----------\n    C : np.ndarray\n        分子軌道係数行列\n\n    Returns\n    -------\n    np.ndarray\n        密度行列\n    \"\"\"\n    return (\n        C[:, [0]] @ C[:, [0]].T\n    )  # 1-4-1と違って2を掛けないのは閉殻でないから。\n\n\nP_beta = calculate_density_matrix_beta(C)\n\"\"\"密度行列\"\"\"\nP_beta\n\n","type":"content","url":"/tedetoku-kadai-1-5-1#id-5","position":17},{"hierarchy":{"lvl1":"電子反発積分の計算"},"type":"lvl1","url":"/tedetoku-kadai-1-5-1#id-6","position":18},{"hierarchy":{"lvl1":"電子反発積分の計算"},"content":"\n\nMAP_ELECTRON_REPULSION_INTEGRAL = MappingProxyType(\n    {\n        ((1, 1), (1, 1)): 1.05625,\n        ((1, 1), (1, 2)): 0.46768,\n        ((1, 1), (2, 1)): 0.46768,\n        ((1, 1), (2, 2)): 0.60640,\n        ((1, 2), (1, 1)): 0.46768,\n        ((1, 2), (1, 2)): 0.24649,\n        ((1, 2), (2, 1)): 0.24649,\n        ((1, 2), (2, 2)): 0.38871,\n        ((2, 1), (1, 1)): 0.46768,\n        ((2, 1), (1, 2)): 0.24649,\n        ((2, 1), (2, 1)): 0.24649,\n        ((2, 1), (2, 2)): 0.38871,\n        ((2, 2), (1, 1)): 0.60640,\n        ((2, 2), (1, 2)): 0.38871,\n        ((2, 2), (2, 1)): 0.38871,\n        ((2, 2), (2, 2)): 0.77500,\n    }\n)\n\"\"\"電子反発積分 (付録より)\"\"\"\nNone\n\n","type":"content","url":"/tedetoku-kadai-1-5-1#id-6","position":19},{"hierarchy":{"lvl1":"Fock行列の計算"},"type":"lvl1","url":"/tedetoku-kadai-1-5-1#fock","position":20},{"hierarchy":{"lvl1":"Fock行列の計算"},"content":"\n\nF_{\\mu \\nu}^\\alpha = H_{\\mu \\nu} + G_{\\mu \\nu}^\\alpha  \\\\\nF_{\\mu \\nu}^\\beta = H_{\\mu \\nu} + G_{\\mu \\nu}^\\beta \\tag{5.26}\n\nH_{\\mu \\nu} は、\n\n先ほど求めているので、G_{\\mu \\nu}^\\alpha, G_{\\mu \\nu}^\\beta を求めたい。\\begin{align*}\n    J_{\\mu \\nu}^\\alpha = \\sum_{\\lambda, \\sigma} (\\mu \\nu | \\lambda \\sigma) P_{\\lambda \\sigma}^\\alpha \\ &,\\ J_{\\mu \\nu}^\\beta = \\sum_{\\lambda, \\sigma} (\\mu \\nu | \\lambda \\sigma) P_{\\lambda \\sigma}^\\beta \\tag{5.21} \\\\\n    K_{\\mu \\nu}^\\alpha = \\sum_{\\lambda, \\sigma} (\\mu \\sigma | \\lambda \\nu) P_{\\lambda \\sigma}^\\alpha \\ &,\\ K_{\\mu \\nu}^\\beta = \\sum_{\\lambda, \\sigma} (\\mu \\sigma | \\lambda \\nu) P_{\\lambda \\sigma}^\\beta \\tag{5.22} \\\\\n    G_{\\mu \\nu}^\\alpha = J_{\\mu \\nu}^\\alpha - K_{\\mu \\nu}^\\alpha + J_{\\mu \\nu}^\\beta \\ &,\\ G_{\\mu \\nu}^\\beta = J_{\\mu \\nu}^\\beta - K_{\\mu \\nu}^\\beta + J_{\\mu \\nu}^\\alpha \\tag{5.23} \\\\\n\\end{align*}\n\ndef calculate_coulomb_energy_matrix(P: np.ndarray) -> np.ndarray:\n    \"\"\"クーロンエネルギー行列を計算する関数\n\n    Parameters\n    ----------\n    P : np.ndarray\n        密度行列\n\n    Returns\n    -------\n    np.ndarray\n        クーロンエネルギー行列\n    \"\"\"\n    return np.array(\n        [\n            [\n                sum(\n                    MAP_ELECTRON_REPULSION_INTEGRAL[\n                        (_mu, _nu), (_lambda, _sigma)\n                    ]\n                    * P[_lambda - 1, _sigma - 1]  # Pは0-indexedなので-1する\n                    for _lambda, _sigma in product((1, 2), repeat=2)\n                )\n                for _nu in (1, 2)\n            ]\n            for _mu in (1, 2)\n        ]\n    )\n\nJ_alpha = calculate_coulomb_energy_matrix(P_alpha)\n\"\"\"クーロンエネルギー行列\"\"\"\nJ_alpha\n\nJ_beta = calculate_coulomb_energy_matrix(P_beta)\n\"\"\"クーロンエネルギー行列\"\"\"\nJ_beta\n\ndef calculate_exchange_energy_matrix(P: np.ndarray) -> np.ndarray:\n    \"\"\"交換エネルギー行列を計算する関数\n\n    Parameters\n    ----------\n    P : np.ndarray\n        密度行列\n\n    Returns\n    -------\n    np.ndarray\n        交換エネルギー行列\n    \"\"\"\n    return np.array(\n        [\n            [\n                sum(\n                    MAP_ELECTRON_REPULSION_INTEGRAL[\n                        (_mu, _sigma), (_lambda, _nu)\n                    ]\n                    * P[_lambda - 1, _sigma - 1]  # Pは0-indexedなので-1する\n                    for _lambda, _sigma in product((1, 2), repeat=2)\n                )\n                for _nu in (1, 2)\n            ]\n            for _mu in (1, 2)\n        ]\n    )\n\nK_alpha = calculate_exchange_energy_matrix(P_alpha)\n\"\"\"交換エネルギー行列\"\"\"\nK_alpha\n\nK_beta = calculate_exchange_energy_matrix(P_beta)\n\"\"\"交換エネルギー行列\"\"\"\nK_beta\n\nG_alpha = J_alpha - K_alpha + J_beta\n\"\"\"2電子積分行列\"\"\"\nG_alpha\n\nG_beta = J_beta - K_beta + J_alpha\n\"\"\"2電子積分行列\"\"\"\nG_beta\n\nF_alpha = H + G_alpha\n\"\"\"Fock行列\"\"\"\nF_alpha\n\nF_beta = H + G_beta\n\"\"\"Fock行列\"\"\"\nF_beta\n\ndef density2fock(\n    P_alpha: np.ndarray, P_beta: np.ndarray\n) -> tuple[np.ndarray, np.ndarray]:\n    \"\"\"密度行列からFock行列を計算する関数\n\n    Parameters\n    ----------\n    P_alpha : np.ndarray\n        upスピンの密度行列\n    P_beta : np.ndarray\n        downスピンの密度行列\n\n    Returns\n    -------\n    tuple[np.ndarray, np.ndarray]\n        upスピンとdownスピンのFock行列\n    \"\"\"\n    J_alpha = calculate_coulomb_energy_matrix(P_alpha)\n    K_alpha = calculate_exchange_energy_matrix(P_alpha)\n    J_beta = calculate_coulomb_energy_matrix(P_beta)\n    K_beta = calculate_exchange_energy_matrix(P_beta)\n\n    G_alpha = J_alpha - K_alpha + J_beta\n    G_beta = J_beta - K_beta + J_alpha\n    return H + G_alpha, H + G_beta\n\ndensity2fock(P_alpha, P_beta)\n\n","type":"content","url":"/tedetoku-kadai-1-5-1#fock","position":21},{"hierarchy":{"lvl1":"RHFエネルギーの計算"},"type":"lvl1","url":"/tedetoku-kadai-1-5-1#rhf","position":22},{"hierarchy":{"lvl1":"RHFエネルギーの計算"},"content":"\n\nE_0^\\mathrm{UHF} = \\frac{1}{2} \\sum_{\\mu,\\nu} P_{\\mu \\nu}^\\alpha \\left[ H_{\\mu \\nu} + F_{\\mu \\nu}^\\alpha \\right] + \\frac{1}{2} \\sum_{\\mu,\\nu} P_{\\mu \\nu}^\\beta \\left[ H_{\\mu \\nu} + F_{\\mu \\nu}^\\beta \\right]  \\tag{5.27}\n\nE_0 = 0.5 * np.sum(P_alpha * (H + F_alpha)) + 0.5 * np.sum(\n    P_beta * (H + F_beta)\n)\n\"\"\"ハミルトニアンに対するRHFエネルギー\"\"\"\nE_0\n\nE_tot = E_0 + V_nuc\n\"\"\"RHF全エネルギー\"\"\"\nE_tot\n\ndef calculate_total_energy(P_alpha: np.ndarray, P_beta: np.ndarray) -> float:\n    \"\"\"全エネルギーを計算する関数\n\n    Parameters\n    ----------\n    P_alpha : np.ndarray\n        upスピンの密度行列\n    P_beta : np.ndarray\n        downスピンの密度行列\n\n    Returns\n    -------\n    float\n        全エネルギー\n    \"\"\"\n    F_alpha, F_beta = density2fock(P_alpha, P_beta)\n    return (\n        0.5 * np.sum(P_alpha * (H + F_alpha))\n        + 0.5 * np.sum(P_beta * (H + F_beta))\n        + V_nuc\n    )\n\ncalculate_total_energy(P_alpha, P_beta)\n\n","type":"content","url":"/tedetoku-kadai-1-5-1#rhf","position":23},{"hierarchy":{"lvl1":"Pople-Nesbet方程式の解法"},"type":"lvl1","url":"/tedetoku-kadai-1-5-1#pople-nesbet","position":24},{"hierarchy":{"lvl1":"Pople-Nesbet方程式の解法"},"content":"基本的には\n\nFock行列を求めるから\n\nRHFエネルギーの計算までを繰り返して、収束要件を満たしたら終わり。\n\ndef scf_cycle(\n    P_alpha: np.ndarray, P_beta: np.ndarray, threshold: float = 1e-4\n) -> tuple[float, tuple[np.ndarray, np.ndarray]]:\n    \"\"\"SCFサイクルを行う関数\n\n    Parameters\n    ----------\n    P_alpha : np.ndarray\n        upスピンの密度行列\n    P_beta : np.ndarray\n        downスピンの密度行列\n\n    Returns\n    -------\n    tuple[float, tuple[np.ndarray, np.ndarray]]\n        全エネルギーとupスピン、downスピンの密度行列\n    \"\"\"\n    # 初期化\n    E_tot_prev = np.inf\n    # 全エネルギー\n    E_tot = calculate_total_energy(P_alpha, P_beta)\n    # 収束判定 (全エネルギーの変化量が閾値以下になるまで繰り返す)\n    while (E_tot_prev - E_tot) > threshold:\n        print(f\"{E_tot=}\")\n        # 全エネルギーを保存\n        E_tot_prev = E_tot\n        # 密度行列からFock行列を計算\n        F_alpha, F_beta = density2fock(P_alpha, P_beta)\n        # 直交化基底に対するFock行列\n        F_alpha_prime = X.T @ F_alpha @ X\n        F_beta_prime = X.T @ F_beta @ X\n        # Fock行列をユニタリ対角化して、(軌道エネルギーと) 分子軌道係数行列を求める\n        _, C_alpha_prime = unitary_diagonalization(F_alpha_prime)\n        _, C_beta_prime = unitary_diagonalization(F_beta_prime)\n        # 分子軌道係数行列を元の基底に戻す\n        C_alpha = X @ C_alpha_prime\n        C_beta = X @ C_beta_prime\n        # 密度行列を計算\n        P_alpha = calculate_density_matrix_alpha(C_alpha)\n        P_beta = calculate_density_matrix_beta(C_beta)\n        # 全エネルギーを計算\n        E_tot = calculate_total_energy(P_alpha, P_beta)\n    return E_tot, (P_alpha, P_beta)\n\nenergy_total_opt, (P_alpha_opt, P_beta_opt) = scf_cycle(P_alpha, P_beta)\n\"\"\"最適化された全エネルギーと密度行列\"\"\"\nprint(f\"{energy_total_opt=}\")\nprint(f\"{P_alpha_opt=}\")\nprint(f\"{P_beta_opt=}\")\n\n","type":"content","url":"/tedetoku-kadai-1-5-1#pople-nesbet","position":25},{"hierarchy":{"lvl1":"分子物性の計算"},"type":"lvl1","url":"/tedetoku-kadai-1-5-1#id-7","position":26},{"hierarchy":{"lvl1":"分子物性の計算"},"content":"\n\nMullikenの電荷解析N_A^\\mathrm{Mul} = \\sum_{\\mu \\in A} \\sum_{\\nu} P_{\\mu \\nu} S_{\\nu \\mu} = \\sum_{\\mu \\in A} (\\rm{PS})_{\\mu \\mu} \\tag{4.53}\n\nPS_alpha = P_alpha_opt @ S\n\"\"\"upスピンの密度行列と重なり行列の積\"\"\"\nPS_beta = P_beta_opt @ S\n\"\"\"downスピンの密度行列と重なり行列の積\"\"\"\n\nN_H_alpha = PS_alpha[0, 0]\n\"\"\"upスピンのH原子の電子数\"\"\"\nN_H_beta = PS_beta[0, 0]\n\"\"\"downスピンのH原子の電子数\"\"\"\nN_He_alpha = PS_alpha[1, 1]\n\"\"\"upスピンのHe原子の電子数\"\"\"\nN_He_beta = PS_beta[1, 1]\n\"\"\"downスピンのHe原子の電子数\"\"\"\n\nN_H = N_H_alpha + N_H_beta\n\"\"\"H原子の電子数\"\"\"\nN_He = N_He_alpha + N_He_beta\n\"\"\"He原子の電子数\"\"\"\n\nprint(f\"{N_H=}\")\nprint(f\"{N_He=}\")\n\nよって、Mulliken電荷は、Q_A = Z_A - N_A^\\mathrm{mul} \\tag{4.54}\n\nより、\n\nQ_He = Z_He - N_He\n\"\"\"Heの電荷\"\"\"\nQ_H = Z_H - N_H\n\"\"\"Hの電荷\"\"\"\nprint(f\"{Q_He=}\")\nprint(f\"{Q_H=}\")\n\nF_alpha_opt, F_beta_opt = density2fock(P_alpha_opt, P_beta_opt)\n\nepsilon_alpha_opt, C_prime_alpha_opt = unitary_diagonalization(\n    X.T @ F_alpha_opt @ X\n)\nepsilon_beta_opt, C_prime_beta_opt = unitary_diagonalization(\n    X.T @ F_beta_opt @ X\n)\n\nC_alpha_opt = X @ C_prime_alpha_opt\nC_beta_opt = X @ C_prime_beta_opt\n\nprint(f\"{epsilon_alpha_opt=}\")\nprint(f\"{C_alpha_opt=}\")\nprint(f\"{epsilon_beta_opt=}\")\nprint(f\"{C_beta_opt=}\")\n\nKoopmansの定理より、イオン化エネルギーおよび電子親和力は、\n\nionic_potential_energy = -epsilon_alpha_opt[1, 1]\n\"\"\"イオン化ポテンシャルエネルギー\"\"\"\nprint(f\"{ionic_potential_energy=} hartree\")\n\nelectron_affinity = -epsilon_beta_opt[1, 1]\n\"\"\"電気陰性度\"\"\"\nprint(f\"{electron_affinity=} hartree\")","type":"content","url":"/tedetoku-kadai-1-5-1#id-7","position":27}]}